!function(b,a){"function"==typeof define&&define.amd?define([],a):"object"==typeof module&&module.exports?(module.exports=a(),module.exports.default=module.exports):b.smokemachine=b.SmokeMachine=a()}("undefined"!=typeof self?self:this,function(){var a=[0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,3,5,5,7,4,4,1,1,0,1,0,0,0,0,0,1,0,0,17,27,41,52,56,34,23,15,11,4,9,5,1,0,0,0,0,0,0,1,45,63,57,45,78,66,52,41,34,37,23,20,0,1,0,0,0,0,1,43,62,66,64,67,115,112,114,56,58,47,33,18,12,10,0,0,0,0,39,50,63,76,87,107,105,112,128,104,69,64,29,18,21,15,0,0,0,7,42,52,85,91,103,126,153,128,124,82,57,52,52,24,1,0,0,0,2,17,41,67,84,100,122,136,159,127,78,69,60,50,47,25,7,1,0,0,0,34,33,66,82,113,138,149,168,175,82,142,133,70,62,41,25,6,0,0,0,18,39,55,113,111,137,141,139,141,128,102,130,90,96,65,37,0,0,0,2,15,27,71,104,129,129,158,140,154,146,150,131,92,100,67,26,3,0,0,0,0,46,73,104,124,145,135,122,107,120,122,101,98,96,35,38,7,2,0,0,0,50,58,91,124,127,139,118,121,177,156,88,90,88,28,43,3,0,0,0,0,30,62,68,91,83,117,89,139,139,99,105,77,32,1,1,0,0,0,0,0,16,21,8,45,101,125,118,87,110,86,64,39,0,0,0,0,0,0,0,0,0,1,28,79,79,117,122,88,84,54,46,11,0,0,0,0,0,0,0,0,0,1,0,6,55,61,68,71,30,16,0,0,0,0,0,0,0,0,0,0,0,0,0,0,14,23,25,20,12,5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,12,9,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,2,2,0,0,0,0,0,0,0,0],b=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;function c(a,b){return a+Math.random()*(b-a)}function d(d,e,a){(a=a||{}).lifetime;var b={x:d,y:e,vx:c(a.minVx|| -0.04,a.maxVx||.04),startvy:c(a.minVy|| -0.4,a.maxVy|| -0.1),scale:c(a.minScale||0,a.maxScale||.5),lifetime:c(a.minLifetime||2e3,a.maxLifetime||8e3),age:0};return b.finalScale=c(a.minScale||25+b.scale,a.maxScale||30+b.scale),b.vy=b.startvy,b}return function(f,e){var g=function(c){c=c||[24,46.8,48.2];for(var e=document.createElement("canvas"),f=e.getContext("2d"),g=f.createImageData(20,20),d=g.data,b=0;b<d.length;b+=4)d[b]=c[0],d[b+1]=c[1],d[b+2]=c[2],d[b+3]=a[b/4];return e.width=20,e.height=20,f.putImageData(g,0,0),e}(e),h=[],i=function(){};function j(a){f.clearRect(0,0,f.canvas.width,f.canvas.height),h.forEach(function(e){var b,c,d;b=e,c=a,b.x+=b.vx*c,b.y+=b.vy*c,d=Math.sqrt(b.age/b.lifetime),b.vy=(1-d)*b.startvy,b.age+=c,b.scale=d*b.finalScale}),i(a,h=h.filter(function(a){return a.age<a.lifetime})),h.forEach(function(a){!function(a,f,e){e.globalAlpha=(1-Math.abs(1-2*a.age/a.lifetime))/8;var b=20*a.scale/2,c=a.x-b,d=a.y-b;e.drawImage(f,c,d,c+2*b-c,d+2*b-d)}(a,g,f)})}var k=!1,l=performance.now();function m(a){if(k){var c=a-l;l=a,j(c),b(m)}}function c(b,c,a,e){if((a=a||10)<1)return Math.random()<=a&&h.push(d(b,c,e));for(var f=0;f<a;f++)h.push(d(b,c,e))}return{step:function(a){a=a||16,console.log(a),j(a)},start:function(){k=!0,l=performance.now(),b(m)},setPreDrawCallback:function(a){i=a},stop:function(){k=!1},addsmoke:c,addSmoke:c}}})